name: ${self:service}-${self:provider.stage}-appsync
authenticationType: AWS_LAMBDA
additionalAuthenticationProviders:
  - authenticationType: API_KEY
lambdaAuthorizerConfig:
  lambdaFunctionArn: arn:aws:lambda:${self:provider.region}:${self:provider.environment.ACCOUNT_ID}:function:${self:service}-${self:provider.stage}-authorizer
  authorizerResultTtlInSeconds: 300

mappingTemplates:
  - type: Query
    field: getUsers
    dataSource: getUsersFunction
    request: false
    response: false
  - type: Query
    field: getAlerts
    dataSource: getAlertsDynamo
    request: click-alert/dynamo/request.vtl
    response: click-alert/dynamo/response.vtl
  - type: Query
    field: getFeedbacks
    dataSource: getFeedbacksDynamo
    request: click-alert/dynamo/request.vtl
    response: click-alert/dynamo/response.vtl
  - type: Mutation
    field: addUser
    dataSource: addUserFunction
    request: false
    response: false
  - type: Mutation
    field: addAlert
    dataSource: addAlertFunction
    request: false
    response: click-alert/response.vtl
  - type: Mutation
    field: addFeedback
    dataSource: addFeedbackFunction
    request: false
    response: click-alert/response.vtl
  - type: Mutation
    field: login
    dataSource: loginFunction
    request: false
    response: false
  - type: Mutation
    field: answers
    dataSource: answersFunction
    request: false
    response: click-alert/response.vtl

  - type: Mutation
    field: removeChatSession
    dataSource: removeChatSessionFunction
    request: false
    response: click-alert/response.vtl

dataSources:
  - type: AWS_LAMBDA
    name: getUsersFunction
    config:
      functionName: getUsers
  - type: AWS_LAMBDA
    name: addUserFunction
    config:
      functionName: addUser
  - type: AWS_LAMBDA
    name: loginFunction
    config:
      functionName: login
  - type: AWS_LAMBDA
    name: authorizerFunction
    config:
      functionName: authorizer
  - type: AMAZON_DYNAMODB
    name: getAlertsDynamo
    config:
      tableName: click-alert-serverless-${self:provider.stage}-alerts
      region: us-east-1
  - type: AMAZON_DYNAMODB
    name: getFeedbacksDynamo
    config:
      tableName: click-alert-serverless-${self:provider.stage}-feedbacks
      region: us-east-1
  - type: AWS_LAMBDA
    name: addAlertFunction
    config:
      lambdaFunctionArn: arn:aws:lambda:${self:provider.region}:${self:provider.environment.ACCOUNT_ID}:function:click-alert-serverless-${self:provider.stage}-addAlert
  - type: AWS_LAMBDA
    name: addFeedbackFunction
    config:
      lambdaFunctionArn: arn:aws:lambda:${self:provider.region}:${self:provider.environment.ACCOUNT_ID}:function:click-alert-serverless-${self:provider.stage}-addFeedback
  - type: AWS_LAMBDA
    name: answersFunction
    config:
      lambdaFunctionArn: arn:aws:lambda:${self:provider.region}:${self:provider.environment.ACCOUNT_ID}:function:click-alert-serverless-${self:provider.stage}-chat
  - type: AWS_LAMBDA
    name: removeChatSessionFunction
    config:
      lambdaFunctionArn: arn:aws:lambda:${self:provider.region}:${self:provider.environment.ACCOUNT_ID}:function:click-alert-serverless-${self:provider.stage}-remove-session-chat
